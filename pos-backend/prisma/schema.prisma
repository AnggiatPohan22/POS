generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum OrderStatus {
  PENDING
  IN_PROGRESS
  PAID
  CANCELLED
}

enum OrderType {
  DINE_IN
  TAKE_AWAY
  DELIVERY
  ROOM
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model menu_categories {
  id          String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String
  slug        String?      @unique
  description String?
  isActive    Boolean?
  menu_items  menu_items[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model menu_item_outlets {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  itemId      String   @db.Uuid  // FIX
  outletId    String?  @db.Uuid  // FIX
  price       Decimal? @db.Decimal
  stock       Int?
  isAvailable Boolean?

  menu_items  menu_items @relation(fields: [itemId], references: [id])
  outlets     outlets?   @relation(fields: [outletId], references: [id])
}


/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model menu_items {
  id          String   @id @default(uuid()) @db.Uuid
  categoryId  String   @db.Uuid
  name        String
  description String?
  basePrice   Decimal  @db.Decimal(18, 2)
  sku         String?
  isAvailable Boolean  @default(true)
  imageUrl    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  order_items       order_items[]
  menuCategories    menu_categories?    @relation(fields: [menu_categoriesId], references: [id])
  menu_categoriesId String?             @db.Uuid
  menuItemOutlets   menu_item_outlets[]
  menuVariants      menu_variants[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model menu_variants {
  id              String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  itemId          String     @db.Uuid // FIX
  name            String?
  additionalPrice Decimal?   @db.Decimal
  isAvailable     Boolean?
  menu_items      menu_items @relation(fields: [itemId], references: [id])
}


/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model outlets {
  id                String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name              String
  code              String?
  timezone          String   @default("Asia/Makassar")
  isActive          Boolean?
  menu_item_outlets menu_item_outlets[]
  tables            tables[]
  transactions      transactions[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model tables {
  id             String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tableNo        Int
  status         String?
  seats          Int?
  outletId       String   @db.Uuid   // FIX: remove default random UUID
  currentOrderId String?  @db.Uuid   // FIX: remove default random UUID
  outlets        outlets  @relation(fields: [outletId], references: [id])
  transactions   transactions[]
}


/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model users {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name      String
  email     String?   @unique
  password  String
  role      String
  phone     String?
  createdAt DateTime? @default(now()) @db.Timestamptz(6)
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model transactions {
  id         String   @id @default(uuid()) @db.Uuid
  customerId String   @db.Uuid
  outletId   String   @db.Uuid
  tableId    String?  @db.Uuid
  orderType  String // Dine-In, Take-Away, Delivery, Room
  status     String   @default("PENDING")
  createdAt  DateTime @default(now())

  customers customers @relation(fields: [customerId], references: [id])
  outlets   outlets   @relation(fields: [outletId], references: [id])
  tables    tables?   @relation(fields: [tableId], references: [id])

  order_items order_items[]
}

model order_items {
  id            String  @id @default(uuid()) @db.Uuid
  transactionId String  @db.Uuid
  menuId        String  @db.Uuid
  qty           Int
  price         Decimal @db.Decimal(18, 2)
  subtotal      Decimal @db.Decimal(18, 2)

  transactions transactions @relation(fields: [transactionId], references: [id], onDelete: Cascade)
  menu_items   menu_items   @relation(fields: [menuId], references: [id])
}

model customers {
  id            String   @id @default(uuid()) @db.Uuid
  billNumber    String   @unique
  customerName  String
  phone         String?
  guests        Int?
  total         Decimal  @default(0.00) @db.Decimal(18, 2)
  tax           Decimal  @default(0.00) @db.Decimal(18, 2)
  serviceCharge Decimal  @default(0.00) @db.Decimal(18, 2)
  grandTotal    Decimal  @default(0.00) @db.Decimal(18, 2)
  status        String   @default("PENDING") // PENDING / PAID / CANCELLED
  createdAt     DateTime @default(now())
  paidAt        DateTime? @db.Timestamp(6)

  transactions transactions[]
  payment_logs payment_logs[]
}

model payment_logs {
  id         String   @id @default(uuid()) @db.Uuid
  customerId String   @db.Uuid
  amount     Decimal  @db.Decimal(18, 2)
  method     String // cash, QRIS, card, etc.
  paidAt     DateTime @default(now())

  customers customers @relation(fields: [customerId], references: [id])
}
